!function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};t=function(){function t(t){this.name=t,this.completed=!1}return t}(),app.factory("TomatoSerializer",["railsSerializer",function(t){return t(function(){return this.only("planTime","workTime","breakTime","planTimeFinished","workTimeFinished","breakTimeFinished","tasks"),this.resource("tasks","Task"),this.nestedAttribute("tasks")})}]),app.factory("Tomato",["$timeout","RailsResource","TomatoSerializer",function(s,n,r){var h;return h=function(n){function h(t,s,i,n){this.breakTime=t,this.planTime=s,this.workTime=i,this.userId=n,this.tick=e(this.tick,this),this.isBreaking=e(this.isBreaking,this),this.isWorking=e(this.isWorking,this),this.isPlanning=e(this.isPlanning,this),this.nextStage=e(this.nextStage,this),this.removeTask=e(this.removeTask,this),this.addTask=e(this.addTask,this),this.currentStageComplete=e(this.currentStageComplete,this),this.newStage=e(this.newStage,this),this.previousStage=e(this.previousStage,this),this.nextStage=e(this.nextStage,this),this.currentStage=e(this.currentStage,this),this.stageFinished=e(this.stageFinished,this),this.onFinished=e(this.onFinished,this),this.stop=e(this.stop,this),this.start=e(this.start,this),this.planStage.sec=this.planTime,this.breakStage.sec=this.breakTime,this.workStage.sec=this.workTime,this.planTimeFinished=0,this.workTimeFinished=0,this.breakTimeFinished=0,this.stageIndex=0,this.planStage.timeFinished=this.planTimeFinished,this.workStage.timeFinished=this.workTimeFinished,this.breakStage.timeFinished=this.breakTimeFinished,this.stages=[this.planStage,this.workStage,this.breakStage],this.numStages=this.stages.length,this.sec=this.stages[this.stageIndex].sec,this.completed=!1,this.tasks=[],this.started=!1}return i(h,n),h.configure({url:"#{apiRootUrl}/users/{{userId}}/tomatoes/{{id}}",name:"tomato",serializer:r}),h.prototype.planStage={title:"Plan",text:"Awesome, you're ready for your next tomato!"},h.prototype.breakStage={title:"Break",text:"Use this stage to plan for the next stage"},h.prototype.workStage={title:"Work",text:"Back to work."},h.prototype.start=function(){return this.started=!0,console.log("Tomato started!"),this.sec=this.stages[this.stageIndex].sec,this.timeout=s(this.tick,1e3)},h.prototype.stop=function(){return this.started=!1},h.prototype.onFinished=function(){return console.log("Finished tomato!"),this.completed=!0},h.prototype.stageFinished=function(){return this.stageIndex++,this.stageIndex<this.numStages?this.sec=this.stages[this.stageIndex].sec:this.onFinished(),this.stop()},h.prototype.currentStage=function(){return this.stages[this.stageIndex].title},h.prototype.nextStage=function(){return this.stageIndex<this.numStages-1?this.stages[this.stageIndex+1].title:null},h.prototype.previousStage=function(){return this.stages[this.stageIndex-1]},h.prototype.newStage=function(){return this.stages[this.stageIndex]},h.prototype.currentStageComplete=function(){return 100*this.sec/this.stages[this.stageIndex].sec},h.prototype.addTask=function(e){return this.tasks.push(new t(e))},h.prototype.removeTask=function(t){return this.tasks.splice(t,1)},h.prototype.nextStage=function(){return console.log(this.stages[this.stageIndex].text),this.completed||this.stageIndex>=this.numStages?void 0:this.start()},h.prototype.isPlanning=function(){return this.started&&0===this.stageIndex},h.prototype.isWorking=function(){return this.started&&1===this.stageIndex},h.prototype.isBreaking=function(){return this.started&&2===this.stageIndex},h.prototype.tick=function(){if(console.log("Tick"),this.started){if(0===this.sec)return this.stageFinished();switch(this.sec--,this.stageIndex){case 0:this.planTimeFinished++;break;case 1:this.workTimeFinished++;break;case 2:this.breakTimeFinished++}return this.timeout=s(this.tick,1e3)}},h}(n)}])}.call(this);