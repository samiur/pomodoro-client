!function(){app.factory("Session",["$http","$cookieStore","$q","User",function(e,r,t,n){var u;return u=function(){function u(){}var o;return u.loggedIn=function(){return this.authToken()},u.authToken=function(){return r.get("authToken")},u.email=function(){return r.get("email")},o=function(){return r.remove("email"),r.remove("authToken")},u.user=null,u.currentUser=function(){var r;return r=t.defer(),this.loggedIn()?this.user?r.resolve(this.user):(e.get("#{apiRootUrl}/users/me",{params:{user_email:this.email(),user_token:this.authToken()}}).success(function(e){return this.user=new n(e.user),r.resolve(this.user)}).error(function(e,t){return o(),r.reject(t)}),r.promise):null},u.signIn=function(n,u){var o;return o=t.defer(),e.post("#{apiRootUrl}/users/sign_in",{email:n,password:u}).success(function(e){var t;return this.loggedIn=!0,t=e.user,this.authToken=e.authentication_token,r.put("email",n),r.put("authToken",authToken),o.resolve(e)}).error(function(e,r){return o.reject(r)}),o.promise},u.signOut=function(){var r;return this.loggedIn()?(r=t.defer(),e["delete"]("#{apiRootUrl}/users/sign_out",{params:{authentication_token:this.authToken()}}).success(function(e){return r.resolve(e)}).error(function(e,t){return r.resolve(t)}),o(),r.promise):null},u}()}])}.call(this);