/**
 * angular-timer - v1.0.5 - 2013-10-11 2:25 PM
 * https://github.com/siddii/angular-timer
 *
 * Copyright (c) 2013 Siddique Hameed
 * Licensed MIT <https://github.com/siddii/angular-timer/blob/master/LICENSE.txt>
 */
angular.module("timer",[]).directive("timer",["$compile",function(t){return{restrict:"E",replace:!1,scope:{interval:"=interval",startTimeAttr:"=startTime",countdownattr:"=countdown",autoStart:"&autoStart"},controller:["$scope","$element","$attrs",function(o,n,e){function i(){o.timeoutId&&clearTimeout(o.timeoutId)}function r(){o.seconds=Math.floor(o.millis/1e3%60),o.minutes=Math.floor(o.millis/6e4%60),o.hours=Math.floor(o.millis/36e5%24),o.days=Math.floor(o.millis/36e5/24)}o.autoStart=e.autoStart||e.autostart,0===n.html().trim().length&&n.append(t("<span>{{millis}}</span>")(o)),o.startTime=null,o.timeoutId=null,o.countdown=o.countdownattr&&parseInt(o.countdownattr,10)>=0?parseInt(o.countdownattr,10):void 0,o.isRunning=!1,o.$on("timer-start",function(){o.start()}),o.$on("timer-resume",function(){o.resume()}),o.$on("timer-stop",function(){o.stop()}),o.start=n[0].start=function(){o.startTime=o.startTimeAttr?new Date(o.startTimeAttr):new Date,o.countdown=o.countdownattr&&parseInt(o.countdownattr,10)>0?parseInt(o.countdownattr,10):void 0,i(),s()},o.resume=n[0].resume=function(){i(),o.countdownattr&&(o.countdown+=1),o.startTime=new Date-(o.stoppedTime-o.startTime),s()},o.stop=o.pause=n[0].stop=n[0].pause=function(){o.stoppedTime=new Date,i(),o.$emit("timer-stopped",{millis:o.millis,seconds:o.seconds,minutes:o.minutes,hours:o.hours,days:o.days}),o.timeoutId=null},n.bind("$destroy",function(){i()}),o.millis=o.countdownattr?1e3*o.countdownattr:0,r();var s=function(){o.millis=new Date-o.startTime;var t=o.millis%1e3;if(o.countdownattr&&(o.millis=1e3*o.countdown),r(),o.countdown>0)o.countdown--;else if(o.countdown<=0)return o.stop(),void 0;o.timeoutId=setTimeout(function(){s(),o.$digest()},o.interval-t),o.$emit("timer-tick",{timeoutId:o.timeoutId,millis:o.millis})};(void 0===o.autoStart||o.autoStart===!0)&&o.start()}]}}]);