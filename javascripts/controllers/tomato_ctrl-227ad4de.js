!function(){var t,o,n=function(t,o){return function(){return t.apply(o,arguments)}};o=function(){function t(t,o){this.startSec=t,this.timeoutFn=o,this.tick=n(this.tick,this),this.onFinished=n(this.onFinished,this),this.stop=n(this.stop,this),this.start=n(this.start,this),this.sec=t,this.timeout=o(this.tick,1e3),this.ticking=!1,this.finished=!1}return t.prototype.start=function(){return this.ticking=!0},t.prototype.stop=function(){return this.ticking=!1},t.prototype.onFinished=function(){return this.stop(),this.finished=!0},t.prototype.tick=function(){return this.ticking?(0===this.sec?this.onFinished():this.sec--,this.timeout=this.timeoutFn(this.tick,1e3)):void 0},t.prototype.percentComplete=function(){return 100*this.sec/this.startSec},t}(),t=["$scope","$modalInstance","title","text",function(t,o,n,e){return t.title=n,t.text=e,t.ok=function(){return o.close("ok")},t.cancel=function(){return o.dismiss("cancel")}}],app.controller("TomatoCtrl",["$scope","$timeout","$modal","$cookieStore","$window","Tomato","User","Session",function(o,n,e,i,r,s,c,a){return o.breakTime=5,o.planTime=5,o.workTime=20,o.loaded=!1,a.loggedIn()||(r.location="home.html"),o.tomatoInProgress=!1,o.$on("currentUserReady",function(){return console.log("I think I'm logged in!"),o.loaded=!0}),o.startTomato=function(){return o.tomato=new s(60*o.breakTime,60*o.planTime,60*o.workTime,o.currentUser.id),o.tomato.start(),o.tomatoInProgress=!0,o.$watch("tomato.started",function(n){var i,s,c;return n?void 0:o.tomato.completed?(o.tomatoInProgress=!1,o.tomato.create().then(function(){return r.location="/dashboard.html"},function(){return console.log("Tomato add failed")})):(console.log("Timer finished"),i=o.tomato.previousStage(),c=o.tomato.newStage(),s=e.open({templateUrl:"/templates/modalInstance.html",controller:t,resolve:{title:function(){return""+i.title+" done! Up next: "+c.title},text:function(){return c.text}}}),s.result.then(function(t){return console.log(t),o.tomato.nextStage()},function(t){return console.log(t)}))})},o.cancelTomato=function(t){return t.stop(),o.tomatoInProgress=!1,t.create().then(function(){return r.location="/dashboard.html"},function(){return console.log("Tomato add failed")})}}])}.call(this);